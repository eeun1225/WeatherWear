<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/header.html :: head"></head>
<meta charset="UTF-8">
<body>
<div th:replace="fragments/header.html :: header"></div>
<div class="row" style="margin-bottom: 30px">
  <div class="offset-1 col-2">
    <h5 style="height: 40px; display: flex; align-items: center; margin: 0px; justify-content: right">
      전체: <span th:text="${boards.totalElements}">0</span>개
    </h5>
  </div>
  <div class="col-6" align="center">
    <form class="form-group" style="height: 40px;" th:object="${boardSearchRequest}" th:method="get" th:action="@{/boards}">
      <select th:field="*{sortType}" style="height: 40px;">
        <option th:value="date">최신순</option>
        <option th:value="like">좋아요순</option>
        <option th:value="comment">댓글순</option>
      </select>
      <select th:field="*{searchType}" style="height: 40px;">
        <option th:value="title">제목</option>
        <option th:value="nickname">작성자</option>
      </select>
      <input type="text" th:field="*{keyword}" placeholder="검색 키워드를 입력해주세요" style="height: 100%; width: 60%;">
      <button class="btn search-btn" type="submit">검색</button>
    </form>
  </div>
  <div class="col-1" align="right">
    <button sec:authorize="!hasAuthority('ADMIN')" class="btn post-btn" type="button" onclick="location.href='/boards/write'">글 작성</button>
    <button sec:authorize="hasAuthority('ADMIN')" class="btn post-btn" type="button" onclick="location.href='/boards/write'">공지 작성</button>
  </div>
</div>
<div class="row">
  <div class="offset-2 col-8">
    <table class="table list-table table-hover text-center">
      <thead style="background-color: #A5F1E9">
      <tr>
        <th style="width: 20%">작성자</th>
        <th style="width: 45%">제목</th>
        <th style="width: 10%">좋아요</th>
        <th style="width: 10%">댓글</th>
        <th style="width: 15%">작성일</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="notice : ${notices}" th:onclick="'location.href=\'/boards/\' + ' + ${notice.id}" class="notice-tr">
        <td style="width: 20%" th:text="${notice.user.nickname}">작성자</td>
        <td style="width: 45%" th:text="${notice.title}">제목</td>
        <td style="width: 10%" th:text="${notice.likeCnt}">0</td>
        <td style="width: 10%" th:text="${notice.commentCnt}">0</td>
        <td style="width: 15%" th:text="${#temporals.format(notice.createdAt, 'yy/MM/dd HH:mm')}">00/00/00 00:00</td>
      </tr>
      <tr th:each="board : ${boards.content}" th:onclick="'location.href=\'/boards/\' + ' + ${board.id}">
        <td style="width: 20%" th:text="${board.user.nickname}">작성자</td>
        <td style="width: 45%" th:text="${board.title}">제목</td>
        <td style="width: 10%" th:text="${board.likeCnt}">0</td>
        <td style="width: 10%" th:text="${board.commentCnt}">0</td>
        <td style="width: 15%" th:text="${#temporals.format(board.createdAt, 'yy/MM/dd HH:mm')}">00/00/00 00:00</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
<script th:inline="javascript">
  window.onload = function () {
    let nowPage = /*[[${boards.number}]]*/ 1 + 1; // 현재 페이지
    let totalPage = /*[[${boards.totalPages}]]*/ 1; // 전체 페이지 수
    let firstPage = Math.floor((nowPage - 1) / 5) * 5 + 1; // 첫 페이지
    let lastPage = Math.min(firstPage + 4, totalPage); // 마지막 페이지

    let pageHtml = "";
    pageHtml += "<li><a class='page-link' href='" + makeUrl(1) + "'>&laquo;</a></li>";
    for (let i = firstPage; i <= lastPage; i++) {
      pageHtml += "<li class='page-item " + (i === nowPage ? "active" : "") + "'>";
      pageHtml += "<a class='page-link' href='" + makeUrl(i) + "'>" + i + "</a></li>";
    }
    pageHtml += "<li><a class='page-link' href='" + makeUrl(totalPage) + "'>&raquo;</a></li>";

    document.getElementById("paging-ul").innerHTML = pageHtml;
  }

  function makeUrl(page) {
    return "/boards?page=" + page;
  }
</script>
</body>
</html>
